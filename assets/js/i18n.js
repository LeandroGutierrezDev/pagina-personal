const translations = {
    es: {
        nav_inicio: "Inicio",
        nav_about: "Sobre mí",
        nav_skills: "Skills",
        nav_portfolio: "Portfolio",
        nav_contact: "Contacto",

        hero_tag: "Full Stack Developer",
        hero_sub: "Construyo soluciones digitales que funcionan.",
        hero_sub2: "Backend sólido · Frontends que se sienten bien.",
        hero_location: "Basado en Buenos Aires, AR.",
        hero_cta: "→ Ver proyectos",

        about_label: "01 — Sobre mí",
        about_title: "En pocas palabras",
        about_p1: 'Actualmente me desempeño como <strong>Analista IT</strong> en una compañía corporativa, donde participo en el análisis, soporte y mejora continua de sistemas en producción. Esta experiencia me dio una comprensión profunda del funcionamiento real de las aplicaciones y fortaleció mi capacidad para diagnosticar problemas y proponer soluciones eficientes y sostenibles.',
        about_p2: 'En paralelo, mi alter ego es <strong>Full Stack Developer</strong> enfocado en el ecosistema JavaScript, donde trabajo en proyectos freelance y personales. Me formé en <strong>Digital House</strong> y continué desarrollando mi experiencia a través de proyectos colaborativos en un entorno orientado al crecimiento de seniority, trabajando con el stack MERN y metodologías similares a las utilizadas en equipos profesionales.',
        about_p3: 'Disfruto tanto del <strong>backend</strong> —diseñando APIs y arquitecturas escalables con Node.js— como del <strong>frontend</strong>, donde busco crear experiencias cuidadas y usables. Me interesa especialmente construir soluciones claras, prácticas y mantenibles.',
        about_p4: 'Siempre estoy buscando desafíos que me permitan seguir creciendo como desarrollador. Si tenés un proyecto en mente o querés colaborar, estoy abierto a conversar.',
        about_location_label: "Ubicación",
        about_location_value: "Lanús, Buenos Aires — Argentina",
        about_avail_label: "Disponibilidad",
        about_avail_value: "Abierto a propuestas - Part time",
        about_focus_label: "Foco",
        about_cta: "→ Contacto",

        skills_label: "02 — Tecnologías",
        skills_title: "Stack & herramientas",

        portfolio_label: "03 — Trabajos",
        portfolio_title: "Proyectos destacados",
        proj_ver_demo: "↗ Ver demo",
        proj_repo: "⌥ Repositorio",

        desc_respirapp: "App de respiración guiada para bajar un cambio y volver al foco. Sin métricas, sin datos, sin ruido. Desarrollada como PWA con Service Worker y Web Manifest, lo que permitió compilarla como APK para Android.",
        desc_pagina: "Portfolio personal desarrollado desde cero. Diseño responsive, animaciones en CSS y JS vanilla, menú hamburguesa para mobile y formulario de contacto integrado.",
        desc_darmando: "Sitio web completo para una fiambrería de Lanús. Incluye secciones de servicios, ubicación y contacto directo por WhatsApp e Instagram. Diseño responsive con menú hamburguesa.",
        desc_condicion: "Landing page de links para perfil de Instagram de comunidad de preparación y supervivencia. Centraliza YouTube, Instagram y canales de WhatsApp en una sola página.",
        desc_fundal: "Diseño gráfico e identidad visual para institución sin fines de lucro. Desarrollo de mockups y materiales visuales con Corel Draw para su plataforma web.",
        desc_reserbar: "App de reservas para bares desarrollada en MERN Stack con autenticación por token. Proyecto grupal de aceleración con No Country. El servidor de producción fue dado de baja al finalizar el programa.",
        desc_cinema: "Proyecto grupal de aceleración de seniority con No Country. Desarrollo del backend con Node.js, Express y endpoints RESTful. El servidor de producción fue dado de baja al finalizar el programa.",
        desc_turnos: "Administrador de pacientes para veterinaria desarrollado en React. Gestión de turnos con estado global, formularios controlados y persistencia de datos.",
        desc_gastos: "App de control semanal de gastos construida en React. Visualización por categoría, seguimiento de presupuesto y gráficos de distribución.",

        contact_label: "04 — Contacto",
        contact_title: "Hablemos",
        contact_copy: "¿Tenés un proyecto en mente, o simplemente querés charlar sobre tecnología? Escribime, siempre estoy abierto a nuevas oportunidades y colaboraciones.",
        form_name: "Nombre",
        form_name_placeholder: "Tu nombre",
        form_email_placeholder: "tu@email.com",
        form_subject: "Asunto",
        form_subject_placeholder: "¿De qué se trata?",
        form_msg: "Mensaje",
        form_msg_placeholder: "Contame tu idea...",
        form_submit: "Enviar mensaje →",

        footer_copy: "Hecho con",
        footer_from: "desde Lanús, Buenos Aires, Argentina",
    },

    pt: {
        nav_inicio: "Início",
        nav_about: "Sobre mim",
        nav_skills: "Skills",
        nav_portfolio: "Portfolio",
        nav_contact: "Contato",

        hero_tag: "Full Stack Developer",
        hero_sub: "Construo soluções digitais que funcionam.",
        hero_sub2: "Backend sólido · Frontends que se sentem bem.",
        hero_location: "Baseado em Buenos Aires, AR.",
        hero_cta: "→ Ver projetos",

        about_label: "01 — Sobre mim",
        about_title: "Em poucas palavras",
        about_p1: 'Atualmente atuo como <strong>Analista de TI</strong> em uma empresa corporativa, onde participo da análise, suporte e melhoria contínua de sistemas em produção. Essa experiência me deu uma compreensão profunda do funcionamento real das aplicações e fortaleceu minha capacidade de diagnosticar problemas e propor soluções eficientes e sustentáveis.',
        about_p2: 'Em paralelo, meu alter ego é <strong>Full Stack Developer</strong> focado no ecossistema JavaScript, onde trabalho em projetos freelance e pessoais. Me formei na <strong>Digital House</strong> e continuei desenvolvendo minha experiência por meio de projetos colaborativos em um ambiente voltado ao crescimento de seniority, trabalhando com o stack MERN e metodologias similares às usadas em equipes profissionais.',
        about_p3: 'Gosto tanto do <strong>backend</strong> — projetando APIs e arquiteturas escaláveis com Node.js — quanto do <strong>frontend</strong>, onde busco criar experiências cuidadas e usáveis. Tenho especial interesse em construir soluções claras, práticas e de fácil manutenção.',
        about_p4: 'Estou sempre em busca de desafios que me permitam continuar crescendo como desenvolvedor. Se você tem um projeto em mente ou quer colaborar, estou aberto para conversar.',
        about_location_label: "Localização",
        about_location_value: "Lanús, Buenos Aires — Argentina",
        about_avail_label: "Disponibilidade",
        about_avail_value: "Aberto a propostas - Part time",
        about_focus_label: "Foco",
        about_cta: "→ Contato",

        skills_label: "02 — Tecnologias",
        skills_title: "Stack & ferramentas",

        portfolio_label: "03 — Trabalhos",
        portfolio_title: "Projetos em destaque",
        proj_ver_demo: "↗ Ver demo",
        proj_repo: "⌥ Repositório",

        desc_respirapp: "App de respiração guiada para diminuir o ritmo e recuperar o foco. Sem métricas, sem dados, sem ruído. Desenvolvida como PWA com Service Worker e Web Manifest, o que permitiu compilá-la como APK para Android.",
        desc_pagina: "Portfolio pessoal desenvolvido do zero. Design responsivo, animações em CSS e JS vanilla, menu hambúrguer para mobile e formulário de contato integrado.",
        desc_darmando: "Site completo para uma rotisserie em Lanús. Inclui seções de serviços, localização e contato direto via WhatsApp e Instagram. Design responsivo com menu hambúrguer.",
        desc_condicion: "Landing page de links para perfil do Instagram de uma comunidade de preparação e sobrevivência. Centraliza YouTube, Instagram e canais de WhatsApp em uma única página.",
        desc_fundal: "Design gráfico e identidade visual para instituição sem fins lucrativos. Desenvolvimento de mockups e materiais visuais com Corel Draw para sua plataforma web.",
        desc_reserbar: "App de reservas para bares desenvolvida em MERN Stack com autenticação por token. Projeto grupal de aceleração com No Country. O servidor de produção foi desativado ao final do programa.",
        desc_cinema: "Projeto grupal de aceleração de seniority com No Country. Desenvolvimento do backend com Node.js, Express e endpoints RESTful. O servidor de produção foi desativado ao final do programa.",
        desc_turnos: "Administrador de pacientes para veterinária desenvolvido em React. Gestão de consultas com estado global, formulários controlados e persistência de dados.",
        desc_gastos: "App de controle semanal de gastos construída em React. Visualização por categoria, acompanhamento de orçamento e gráficos de distribuição.",

        contact_label: "04 — Contato",
        contact_title: "Vamos conversar",
        contact_copy: "Você tem um projeto em mente, ou simplesmente quer bater um papo sobre tecnologia? Me escreva, estou sempre aberto a novas oportunidades e colaborações.",
        form_name: "Nome",
        form_name_placeholder: "Seu nome",
        form_email_placeholder: "seu@email.com",
        form_subject: "Assunto",
        form_subject_placeholder: "Do que se trata?",
        form_msg: "Mensagem",
        form_msg_placeholder: "Me conte sua ideia...",
        form_submit: "Enviar mensagem →",

        footer_copy: "Feito com",
        footer_from: "de Lanús, Buenos Aires, Argentina",
    }
};

// ─── Banderas SVG inline ──────────────────────────────────────────────────────

const flags = {
    es: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600" width="22" height="15" style="border-radius:2px;display:block;">
    <rect width="900" height="600" fill="#74ACDF"/>
    <rect y="200" width="900" height="200" fill="#fff"/>
    <ellipse cx="450" cy="300" rx="55" ry="55" fill="#F6B40E" stroke="#85340A" stroke-width="6"/>
    <ellipse cx="450" cy="300" rx="36" ry="36" fill="#F6B40E"/>
  </svg>`,
    pt: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600" width="22" height="15" style="border-radius:2px;display:block;">
    <rect width="900" height="600" fill="#009C3B"/>
    <polygon points="450,80 820,300 450,520 80,300" fill="#FFDF00"/>
    <circle cx="450" cy="300" r="110" fill="#002776"/>
    <path d="M340,265 Q450,205 560,265" stroke="#fff" stroke-width="9" fill="none" stroke-linecap="round"/>
  </svg>`
};

// ─── Engine ───────────────────────────────────────────────────────────────────

function applyTranslations(lang) {
    const t = translations[lang];

    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (t[key] !== undefined) el.textContent = t[key];
    });

    document.querySelectorAll('[data-i18n-html]').forEach(el => {
        const key = el.getAttribute('data-i18n-html');
        if (t[key] !== undefined) el.innerHTML = t[key];
    });

    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if (t[key] !== undefined) el.placeholder = t[key];
    });

    document.documentElement.lang = lang;
    localStorage.setItem('lang', lang);

    // Actualizar bandera en el trigger
    const flagSlot = document.querySelector('.lang-trigger .lang-flag-slot');
    if (flagSlot) flagSlot.innerHTML = flags[lang];

    // Marcar opción activa
    document.querySelectorAll('.lang-option').forEach(opt => {
        opt.classList.toggle('active', opt.dataset.lang === lang);
    });

    closeDropdown();
}

function closeDropdown() {
    const dropdown = document.querySelector('.lang-dropdown');
    const trigger = document.querySelector('.lang-trigger');
    if (dropdown) dropdown.classList.remove('open');
    if (trigger) { trigger.classList.remove('open'); trigger.setAttribute('aria-expanded', 'false'); }
}

function initLangSwitcher() {
    const savedLang = localStorage.getItem('lang') || 'es';

    // ── Markup ──
    const switcher = document.createElement('div');
    switcher.className = 'lang-switcher';
    switcher.innerHTML = `
    <button class="lang-trigger" aria-haspopup="true" aria-expanded="false" aria-label="Seleccionar idioma">
      <span class="lang-flag-slot">${flags[savedLang]}</span>
      <span class="lang-trigger-label">Idioma</span>
      <svg class="lang-chevron" xmlns="http://www.w3.org/2000/svg" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="6 9 12 15 18 9"/>
      </svg>
    </button>
    <div class="lang-dropdown" role="menu">
      <button class="lang-option" data-lang="es" role="menuitem">
        <span class="lang-flag-slot">${flags.es}</span>
        <span class="lang-option-label">
          <span class="lang-option-name">Español</span>
          <span class="lang-option-country">Argentina</span>
        </span>
        <span class="lang-option-check">✓</span>
      </button>
      <button class="lang-option" data-lang="pt" role="menuitem">
        <span class="lang-flag-slot">${flags.pt}</span>
        <span class="lang-option-label">
          <span class="lang-option-name">Português</span>
          <span class="lang-option-country">Brasil</span>
        </span>
        <span class="lang-option-check">✓</span>
      </button>
    </div>
  `;

    const li = document.createElement('li');
    li.appendChild(switcher);
    document.getElementById('navLinks').appendChild(li);

    const trigger = switcher.querySelector('.lang-trigger');
    const dropdown = switcher.querySelector('.lang-dropdown');

    trigger.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = dropdown.classList.contains('open');
        dropdown.classList.toggle('open', !isOpen);
        trigger.classList.toggle('open', !isOpen);
        trigger.setAttribute('aria-expanded', String(!isOpen));
    });

    dropdown.querySelectorAll('.lang-option').forEach(opt => {
        opt.addEventListener('click', (e) => {
            e.stopPropagation();
            applyTranslations(opt.dataset.lang);
        });
    });

    // Cerrar al clickear fuera
    document.addEventListener('click', closeDropdown);

    // Cerrar si abre el menú hamburguesa
    document.getElementById('navToggle')?.addEventListener('click', closeDropdown);

    applyTranslations(savedLang);
}

document.addEventListener('DOMContentLoaded', initLangSwitcher);